# sysimage_creator

- This repository aims to provide scripts that create sysimage via PackageCompiler.jl .
- It will reduce latency when working locally with packages that has a high startup time e.g. Plots.jl or StatsPlots.jl .

# Usage

## Setup 

```console
$ pip install jupyter jupytext
$ pip install nbconvert ipykernel # for Windows users
$ julia setup.jl
```

## Create sysimage

- Just run `make`. It will make sysimage named `sys.{DLEXT}`, where `DLEXT` is `dylib, dll or so`.

```
$ make
...
...
...
$ ls
sys.dylib # e.g. macOS users
```

## Testout sysimage

### Case 1: from terminal

- You can feel how much time we can reduce latency when we use our sysimage:

```
$ cat benchmark.jl
# use standard julia
@time run(`jupytext --to ipynb --execute testout_naive.jl`)
# use sys.${DLEXT} as sysimage
@time run(`jupytext --to ipynb --execute testout_sys.jl`)
$ julia --project=@. benchmark.jl
```

or just run `make test` :D.

### Case 2: from jupyter 

- Open Jupyter Notebook as always:

```
$ jupyter notebook
```

- Then you'll see New kernel for Julia named `Julia-sys 1.6.0`. 

![](assets/jupyter_kernel_list.png)

- Please select it. This kernel is generated by `installkernel.jl` which is stored in this repository.

```console
$ cat ~/Library/Jupyter/kernels/julia-sys-1.6/kernel.json
{
  "display_name": "Julia-sys 1.6.0",
  "argv": [
    "/Applications/Julia-1.6.app/Contents/Resources/julia/bin/julia",
    "-i",
    "--color=yes",
    "--project=@.",
    "--sysimage=sys", # <--- this `sys` is a name of sysimage 
    "/Users/<your-user-name>/.julia/packages/IJulia/e8kqU/src/kernel.jl",
    "{connection_file}"
  ],
  "language": "julia",
  "env": {},
  "interrupt_mode": "signal"
}
```

- If you click `testout_sys.jl` file, Jupyter recognize this file as notebook, and initialize it with option `--sysimage=sys`.
- Here is a result of running `testout_sys.jl` using our sysimage:

![](assets/testout_sys.png)

- Here is a result of running `testout_naive.jl` using standard sysimage, which is so slow:

![](assets/testout_naive.png)

